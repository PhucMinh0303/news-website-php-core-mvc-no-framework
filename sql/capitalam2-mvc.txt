CREATE TABLE categories (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(150) NOT NULL,
    slug VARCHAR(150) UNIQUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE authors (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(150) NOT NULL,
    email VARCHAR(150),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE news (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    slug VARCHAR(255) UNIQUE,
    category_id INT NOT NULL,
    author_id INT NOT NULL,
    thumbnail VARCHAR(255),
    content LONGTEXT NOT NULL,
    published_at DATETIME,
    status TINYINT DEFAULT 1 COMMENT '1=hiển thị, 0=ẩn',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    CONSTRAINT fk_news_category FOREIGN KEY (category_id) REFERENCES categories(id),
    CONSTRAINT fk_news_author FOREIGN KEY (author_id) REFERENCES authors(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE recruitments (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    slug VARCHAR(255) UNIQUE,
    job_description LONGTEXT NOT NULL,
    job_requirement LONGTEXT NOT NULL,
    job_benefit LONGTEXT,
    image VARCHAR(255),
    location VARCHAR(150),
    salary VARCHAR(100),
    deadline DATE,
    status TINYINT DEFAULT 1 COMMENT '1=đang tuyển, 0=đã đóng',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO categories (name, slug)
VALUES ('Công nghệ', 'cong-nghe');

INSERT INTO authors (name, email)
VALUES ('Admin', 'admin@news.com');

INSERT INTO news (
    title, slug, category_id, author_id, thumbnail, content, published_at
) VALUES (
    'PHP 8.3 có gì mới?',
    'php-8-3-co-gi-moi',
    1,
    1,
    'php83.jpg',
    'Nội dung chi tiết bài viết...',
    NOW()
);

INSERT INTO recruitments (
    title, slug, job_description, job_requirement, job_benefit, salary, deadline
) VALUES (
    'Tuyển PHP Developer',
    'tuyen-php-developer',
    'Phát triển hệ thống website',
    'Kinh nghiệm PHP, MySQL',
    'Lương thưởng, BHXH',
    '15 - 25 triệu',
    '2026-03-31'
);

CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(150) NOT NULL UNIQUE COMMENT 'Tên đăng nhập (tên tác giả)',
    password VARCHAR(255) NOT NULL COMMENT 'Mật khẩu đã hash',
    full_name VARCHAR(150),
    email VARCHAR(150),
    role ENUM('admin','editor','author') DEFAULT 'author',
    status TINYINT DEFAULT 1 COMMENT '1=hoạt động, 0=khóa',
    last_login DATETIME NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

ALTER TABLE news
DROP FOREIGN KEY fk_news_author;

ALTER TABLE news
CHANGE author_id user_id INT NOT NULL;

ALTER TABLE news
ADD CONSTRAINT fk_news_user
FOREIGN KEY (user_id) REFERENCES users(id);

INSERT INTO users (username, password, full_name, role)
VALUES (
    'admin',
    '$2y$10$QdP9XXXXXXXXXXXXXXXXXXXXXXXXXXXXX',
    'Quản trị viên',
    'admin'
);

SELECT *
FROM users
WHERE username = :username
  AND status = 1
LIMIT 1;

CREATE TABLE contacts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(150) NOT NULL COMMENT 'Tên khách hàng',
    phone VARCHAR(20) NOT NULL COMMENT 'Số điện thoại',
    email VARCHAR(150) NULL COMMENT 'Email khách hàng',
    message LONGTEXT NOT NULL COMMENT 'Nội dung liên hệ',
    ip_address VARCHAR(45) NULL COMMENT 'IP người gửi',
    user_agent VARCHAR(255) NULL COMMENT 'Trình duyệt người gửi',
    status TINYINT DEFAULT 0 COMMENT '0=chưa xử lý, 1=đã phản hồi',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO contacts (name, phone, email, message)
VALUES (
    'Nguyễn Văn A',
    '0989123456',
    'nguyenvana@gmail.com',
    'Tôi muốn tư vấn dịch vụ thiết kế website.'
);

SELECT * FROM contacts ORDER BY created_at DESC;

UPDATE contacts SET status = 1 WHERE id = 1;

