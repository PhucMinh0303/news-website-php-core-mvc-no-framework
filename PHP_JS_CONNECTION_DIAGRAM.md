# PHP ↔ JavaScript Connection Diagram

## Visual Architecture Map

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      HOMEPAGE REQUEST TO INTERACTIVE PAGE                    │
└─────────────────────────────────────────────────────────────────────────────┘

USER BROWSER
    ↓
    └─→ GET / HTTP/1.1
        ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│ PHP SERVER SIDE                                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│ 1. index.php (Entry Point)                                                  │
│    └─ require 'app/bootstrap.php'                                           │
│                                                                              │
│ 2. app/bootstrap.php                                                        │
│    ├─ Load configuration                                                    │
│    ├─ Register autoloader                                                   │
│    └─ Initialize Router                                                     │
│                                                                              │
│ 3. Router Matching                                                           │
│    └─ Matches "/" → HomeController@index()                                  │
│                                                                              │
│ 4. HomeController::index()                                                  │
│    ├─ Fetch data (if needed)                                                │
│    └─ $this->render('homepage/homepage')                                    │
│                                                                              │
│ 5. app/views/homepage/homepage.php RENDERS                                  │
│    │                                                                         │
│    ├─ includes head-root.php                  [CSS, META, DOCTYPE]         │
│    ├─ includes header.php                     [Creates #header div]        │
│    ├─ includes section1.php                   [Creates #section1 div]      │
│    ├─ includes section2.php                   [HTML content]                │
│    ├─ includes section3-2.php                 [Creates #section3 div]      │
│    ├─ includes section4.php                   [Creates #section4 div]      │
│    ├─ includes section5.php                   [Creates #section5 div]      │
│    ├─ includes footer.php                     [Creates #footer div]        │
│    │                                                                         │
│    └─ includes scripts-root.php [SCRIPT LOADING] ←─ KEY CONNECTION POINT   │
│       ├─ <script src="/public/assets/js/script.js"></script>               │
│        │  └─ Generated by: View::asset('js/script.js')                      │
│       ├─ <script src="...swiper..."></script>                              │
│       └─ <script src="...aos..."></script>                                 │
│                                                                              │
│ HTML Structure Sent to Browser:                                             │
│ ┌───────────────────────────────────────────────────┐                       │
│ │ <!DOCTYPE html>                                   │                       │
│ │ <head>...</head>                                  │                       │
│ │ <body>                                            │                       │
│ │   <div id="header"></div>                         │                       │
│ │   <div id="section1"></div>                       │                       │
│ │   <div id="section3"></div>                       │                       │
│ │   <div id="section4"></div>                       │                       │
│ │   <div id="section5"></div>                       │                       │
│ │   <div id="footer"></div>                         │                       │
│ │   <script src="/public/assets/js/script.js"></script>                    │
│ │ </body>                                           │                       │
│ │ </html>                                           │                       │
│ └───────────────────────────────────────────────────┘                       │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                           ↓ HTTP Response
┌─────────────────────────────────────────────────────────────────────────────┐
│ BROWSER SIDE                                                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│ 1. PARSE HTML                                                               │
│    ├─ Create DOM tree                                                       │
│    ├─ Apply CSS stylesheets                                                 │
│    └─ Render page layout                                                    │
│                                                                              │
│ 2. LOAD EXTERNAL LIBRARIES                                                  │
│    ├─ Swiper (carousel library)    ✓                                       │
│    └─ AOS (animation library)      ✓                                       │
│                                                                              │
│ 3. EXECUTE script.js [NOW SAFE TO RUN]                                     │
│    ├─ Access DOM elements: ✓                                                │
│    ├─ Access Swiper library: ✓                                              │
│    ├─ Access AOS library: ✓                                                 │
│    └─ Make fetch requests: ✓                                                │
│                                                                              │
│ 4. FETCH CONTENT FROM PHP VIEWS                                             │
│    │                                                                         │
│    ├─ fetch("../../app/views/pages/include/header.php")                    │
│    │  └─ ↓ Returns HTML → #header.innerHTML = html                         │
│    │                                                                         │
│    ├─ fetch("/introduce/section1")                                         │
│    │  └─ Router: PageController@section1 → section1.php                    │
│    │     ↓ Returns HTML → #section1.innerHTML = html                       │
│    │     ↓ setTimeout(initSection1Events, 100)                             │
│    │                                                                         │
│    ├─ fetch("/introduce/section3-2")                                       │
│    │  └─ Router: PageController@section3_2 → section3-2.php               │
│    │     ↓ Returns HTML → #section3.innerHTML = html                       │
│    │     ↓ setTimeout(initSection3Events, 100)                             │
│    │                                                                         │
│    ├─ fetch("/introduce/section4")                                         │
│    │  └─ Router: PageController@section4 → section4.php                    │
│    │     ↓ Returns HTML → #section4.innerHTML = html                       │
│    │     ↓ setTimeout(initSection4Carousel, 100)                           │
│    │                                                                         │
│    ├─ fetch("/introduce/section5")                                         │
│    │  └─ Router: PageController@section5 → section5.php                    │
│    │     ↓ Returns HTML → #section5.innerHTML = html                       │
│    │                                                                         │
│    └─ fetch("../../app/views/pages/include/footer.php")                    │
│       └─ ↓ Returns HTML → #footer.innerHTML = html                         │
│                                                                              │
│ 5. INITIALIZE COMPONENTS                                                    │
│    ├─ Swiper('#section1 .swiper', {...}) → Slider                         │
│    ├─ initSection3Events() → Hover listeners                                │
│    ├─ initSection4Carousel() → Carousel                                     │
│    └─ initSearchBoxToggle() → Search                                        │
│                                                                              │
│ 6. EVENT LISTENERS ATTACHED                                                 │
│    ├─ Menu clicks                                ? Responding to events    │
│    ├─ Hover effects                              ? Displaying interactions │
│    ├─ Slider controls                            ? User controls working   │
│    └─ Form interactions                          ? Ready for input        │
│                                                                              │
│ 7. PAGE FULLY INTERACTIVE ✓                                                │
│    └─ User can interact with all elements                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Connection Points Detail

### Connection Point 1: View Helper

```
FILE LOCATION: app/core/View.php
METHOD: View::asset()

┌─────────────────────────────────────────────────────────────┐
│ PHP CODE in scripts-root.php                                │
│ <script src="<?php echo View::asset('js/script.js'); ?>"> │
│                        ↓                                     │
│ View::asset('js/script.js')                                 │
│   └─ Adds prefix: '/public/assets/' + 'js/script.js'       │
│   └─ Returns: '/public/assets/js/script.js'               │
│                        ↓                                     │
│ BROWSER SEES:                                               │
│ <script src="/public/assets/js/script.js"></script>        │
│                        ↓                                     │
│ FILE SERVED:                                                │
│ d:\xampp\htdocs\capitalam2-mvc\public\assets\js\script.js  │
└─────────────────────────────────────────────────────────────┘
```

---

### Connection Point 2: DOM Container Mapping

```
PHP CREATES STRUCTURE
app/views/homepage/homepage.php
├─ <html>
│  ├─ <head>...</head>
│  └─ <body>
│     ├─ <div id="header"></div>       ← JS Target
│     ├─ <div id="section1"></div>     ← JS Target
│     ├─ <div id="section3"></div>     ← JS Target
│     ├─ <div id="section4"></div>     ← JS Target
│     ├─ <div id="section5"></div>     ← JS Target
│     ├─ <div id="footer"></div>       ← JS Target
│     └─ <script src="..."></script>   ← Loads script.js

JS TARGETS CONTAINERS
public/assets/js/script.js
├─ document.getElementById("header")
│  └─ fetch(...) → .innerHTML = content
│
├─ document.getElementById("section1")
│  └─ fetch(...) → .innerHTML = content
│
├─ document.getElementById("section3")
│  └─ fetch(...) → .innerHTML = content
│
├─ document.getElementById("section4")
│  └─ fetch(...) → .innerHTML = content
│
├─ document.getElementById("section5")
│  └─ fetch(...) → .innerHTML = content
│
└─ document.getElementById("footer")
   └─ fetch(...) → .innerHTML = content
```

---

### Connection Point 3: Fetch Path Resolution

```
JAVASCRIPT FETCH PATHS
══════════════════════

Relative Path (Filesystem):
───────────────────────────
fetch("../../app/views/pages/include/header.php")
  From: d:\xampp\htdocs\capitalam2-mvc\public\assets\js\script.js
  ↓ Navigate up 2 levels: ../../
  ↓ ..\xampp\htdocs\capitalam2-mvc\
  ↓ Then: app\views\pages\include\header.php
  Serves: app/views/pages/include/header.php
  Response: HTML string

Router Path (Application):
──────────────────────────
fetch("/introduce/section1")
  From: Browser → Application Server
  ↓ Router matches: GET /introduce/section1
  ↓ routes/web_routes.php:
     'GET /introduce/section1' => 'Page@section1'
  ↓ PageController::section1()
  ↓ return $this->view('pages/introduce/section1');
  ↓ Renders: app/views/pages/introduce/section1.php
  Response: HTML string
```

---

## File Connections Map

```
                     app/bootstrap.php
                            ↓
                       Router.php
                            ↓
                 HomeController@index()
                            ↓
        app/views/homepage/homepage.php
        │
        ├─→ head-root.php
        │
        ├─→ header.php
        │
        ├─→ section1.php
        ├─→ section2.php
        ├─→ section3-2.php
        ├─→ section4.php
        ├─→ section5.php
        │
        ├─→ footer.php
        │
        └─→ scripts-root.php [LOAD POINT]
            │
            ├─ <script src="/public/assets/js/script.js"></script>
            │  └─ Loads: public/assets/js/script.js
            │
            ├─ <script src="swiper..."></script>
            └─ <script src="aos..."></script>


        public/assets/js/script.js [NOW EXECUTES]
        ├─ Fetches from router:
        │  ├─ /introduce/section1 → PageController → section1.php
        │  ├─ /introduce/section3-2 → PageController → section3-2.php
        │  ├─ /introduce/section4 → PageController → section4.php
        │  └─ /introduce/section5 → PageController → section5.php
        │
        └─ Fetches from filesystem:
           ├─ ../../app/views/pages/include/header.php
           └─ ../../app/views/pages/include/footer.php
```

---

## Initialization Timeline

```
T=0ms   │ User requests /
        │
T=100ms │ Server sends HTML response
        │ Contains: containers (#section1, etc) + <script src="...">
        │
T=200ms │ Browser parses HTML
        │ DOM tree created with all #id elements
        │
T=300ms │ CSS stylesheets loaded
        │ Swiper & AOS libraries loaded
        │
T=400ms │ script.js starts executing
        │
T=410ms │ fetch("/introduce/section1") starts
        │
T=420ms │ fetch("../../app/views/pages/include/header.php") starts
        │ Other fetches also start (parallel)
        │
T=450ms │ First fetch returns (server processes request)
        │ document.getElementById("section1").innerHTML = html
        │
T=460ms │ setTimeout(initSection1Events, 100) scheduled
        │
T=550ms │ 100ms passed, initSection1Events() runs
        │ new Swiper() initialized
        │ Event listeners attached
        │
T=600ms │ All fetches complete
        │ All components initialized
        │ All elements rendered
        │
T=601ms │ ✅ PAGE FULLY INTERACTIVE
        │    User can interact with all elements
```

---

## Data Flow Examples

### Example 1: Header Loading

```
┌─────────────────────────────────────────────────────────────────┐
│ 1. script.js executes                                           │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│ 2. fetch("../../app/views/pages/include/header.php")          │
│    Relative path: From script.js location, go back 2 dirs     │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│ 3. Server receives request for header.php                       │
│    Reads: app/views/pages/include/header.php                   │
│    Returns: HTML content (navbar, logo, menu HTML)             │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│ 4. JavaScript receives HTML                                     │
│    .then((res) => res.text()) → converts to string             │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│ 5. document.getElementById("header").innerHTML = htmlString    │
│    Injects HTML into <div id="header"></div>                   │
│    Menu elements now exist in DOM                              │
└─────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│ 6. Event listeners attached                                     │
│    .addEventListener("click", ...) on menu items               │
│    Menu now responds to user clicks                            │
└─────────────────────────────────────────────────────────────────┘
```

### Example 2: Section1 (Slider) Loading

```
script.js:
└─ fetch("/introduce/section1")        [Absolute path through router]
   .then(res => res.text())
   .then(html => {
     document.getElementById("section1").innerHTML = html;
     setTimeout(() => {
       initSection1Events();  // Swiper initialization
     }, 100);
   })

Server handling:
└─ Router matches: GET /introduce/section1
   ↓
   routes/web_routes.php maps to: PageController@section1
   ↓
   PageController::section1() runs
   ↓
   return view('pages/introduce/section1');
   ↓
   Renders: app/views/pages/introduce/section1.php
   ↓
   Returns HTML with: <div class="swiper">...</div>

Browser:
└─ #section1.innerHTML = html  [Slider HTML now in DOM]
   ↓
   setTimeout waits 100ms [For browser to render elements]
   ↓
   initSection1Events() runs
   ↓
   new Swiper('.swiper', {...}) [Creates interactive slider]
   ↓
   ✓ Slider ready for user interaction
```

---

## File References

| File                                     | Purpose           | Connection                                     |
| ---------------------------------------- | ----------------- | ---------------------------------------------- |
| app/views/homepage/homepage.php          | Main view         | Includes all sections + loads scripts-root.php |
| app/views/pages/include/scripts-root.php | Script loading    | Source of `<script src="...">` tags            |
| app/core/View.php                        | View helper       | Contains View::asset() function                |
| public/assets/js/script.js               | Client logic      | Fetches PHP views + initializes components     |
| app/core/Router.php                      | URL routing       | Maps /introduce/section1 → PHP views           |
| routes/web_routes.php                    | Route definitions | Defines GET /introduce/... routes              |

---

## Common Issues & Solutions

| Issue                 | Cause                   | Solution                                    |
| --------------------- | ----------------------- | ------------------------------------------- |
| script.js returns 404 | Incorrect asset path    | Verify View::asset() is used correctly      |
| Elements not found    | Fetch not completed yet | Use setTimeout before initializing          |
| Swiper undefined      | Library not loaded      | Verify Swiper loads before script.js        |
| Content not injecting | Container not found     | Verify #section1, etc exist in homepage.php |
| Events not working    | Querying before render  | Add 100ms setTimeout delay                  |
| Fetch returns 404     | Wrong fetch path        | Check router maps /introduce/section1       |

---

## Key Takeaways

1. **PHP creates containers** → `<div id="section1"></div>`
2. **PHP loads script** → `<script src="...script.js"></script>`
3. **JS finds containers** → `document.getElementById("section1")`
4. **JS fetches content** → `fetch("/introduce/section1")`
5. **Router serves views** → `PageController@section1 → section1.php`
6. **JS injects content** → `.innerHTML = htmlContent`
7. **JS initializes** → `new Swiper(...)`
8. **Events attached** → `.addEventListener(...)`
9. **Page interactive** → User can interact ✓
